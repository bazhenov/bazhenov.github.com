---
date: 2009-01-09
url: /blog/2009/01/09/terracotta-vs-memcache.html
title: Terracotta vs. Memcache
layout: post
tags: cache java
alias: /2009/01/terracotta-vs-memcache.html
---
В последнее время начали сравнивать `terracotta` и `memcache`. Мне это сравнение кажется некорректным. Бытует мнение что `terracotta` — это distributed cache[^distributed-cache]. Это все равно что называть автомобиль "четырехколесным мопедом", только потому, что он может ездить и у него четыре колеса.

`Terracotta` часто определяют как Network Attached Memory. И это правда, но не вся. Технически никто не мешает вам использовать `terracotta` как distributed (или, как его еще иногда называют, clustered) cache. Но тут возникает проблема с HA. В кластере Terracotta всегда есть координатор, который управляет потоком данных. По словам Ari Zilka[^ari-zilka-interview] (одного из основателей Terracota Inc.), именно по этой причине terracotta очень хорошо масштабируется, так как благодаря наличию координатора нет необходимости использовать multicast передачу данных. Однако, наличие координатора означает single point of failure. При использовании memcache SPOF нету, но вам необходимо самому распределять данные по нодам.

Используя terracota вы можете взять `LinkedBlockingQueue<Runnable>`, пометить его как shared и обрабатывать очередь задач на всех нодах кластера. Вместе с корректной имплементацией распределенных локов мы имеем отличную платформу для распределенных вычислений и возможно даже хранения данных.

С кешем все иначе. Его природа имеет несколько особенностей:

* потерю кеша приложение должно способно пережить (не требуется HA);
* при работе с кешем можно обойтись без атомарных его обновлений (не требуются атомарные примитивы и локи).

С первым все должно быть понятно. Если приложение не смогло пережить потерю кеша, значит там хранился оригинал каких-либо данных, а следовательно это уже не кеш. Со вторым немного сложнее. Так как значение в кеше зависит только от внешних данных (данных не хранящихся в кеше), значит невозможны операции когда новое значение кеша зависит от его предыдущего значения. А значит не нужны атомарные обновления.

`Memсache` отлично подходит для таких сценариев. Ну а если вы решили использовать `memcache` как storage, а не как кеш, то вы обречены на собственную реализацию атомарного обновления данных[^ref-php-sessions-memcache], как минимум.

Таким образом, `memcache` и `terracotta` — это совсем разные вещи. Первое — это просто Network Attached Memory сервер. И без дополнительного кодирования его можно использовать только для кеширования данных. Второе — полноценная платформа для кластеризации вычислений. Как говорится, know your enemy.

[^distributed-cache]: [Memcached and Terracotta : Alternatives or Complementary?](http://debasishg.blogspot.com/2008/09/memcached-and-terracotta-alternatives.html)
[^ari-zilka-interview]: [Ari Zilka on Terracotta, Clustering and Open Source](http://www.infoq.com/interviews/ari-zilka-terracotta)
[^ref-php-sessions-memcache]: [Особенности хранения сессий PHP в memcached](http://habrahabr.ru/blogs/php/38261/)
*[SPOF]: Single Point of Failure
*[HA]: High Availability
