<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru-ru">
<head>
	 <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	 <meta http-equiv="content-type" content="text/html; charset=utf-8" />
	 <title>Особенности функциональщины в Java</title>
	 <meta name="author" content="Denis Bazhenov" />
	 <link href="http://feeds.feedburner.com/severe-reality" rel="alternate" title="Severe Reality" type="application/atom+xml" />
	 <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,600&subset=latin,cyrillic-ext,cyrillic' rel='stylesheet' type='text/css'>
	 
	 <link rel="openid2.provider" href="https://www.google.com/accounts/o8/ud?source=profiles" > 
	 <link rel="openid2.local_id" href="http://www.google.com/profiles/dotsid" >
	 
	 <!-- syntax highlighting CSS -->
	 <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
	 <!-- Homepage CSS -->
	 <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
	 <link rel="stylesheet" href="http://yandex.st/highlightjs/6.1/styles/idea.min.css">

	<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
</head>
<body>

	<div class="site">
		
			<header>
				<div class="content">
					<a href="/">Суровая реальность</a>
				</div>
			</header>
		

		<div class="post content">
	<h1>Особенности функциональщины в Java</h1>
	<div class="meta">
		<span class="date">12 May 2012</span>
		<span class="tags">
			
				<a href="/tags.html#java">java</a>
			
				<a href="/tags.html#programming">programming</a>
			
				<a href="/tags.html#guava">guava</a>
			
		</span>
		
	</div>
	
	
	<p>Некоторое время назад мне довелось участвовать в одном из подпроектов целью которого было извлечение упоминаний об автомобилях из произвольного текста с использованием экспертной информации. Это задачу в простонародье называют парсингом :). Так или иначе, этот класс задач имеет свою специфику связанную с относительно большим количеством различных операций над коллекциями. Связано это с необходимостью проверки различных гипотез относительно содержимого анализируемого текста. Оперирование над коллекциями это сильная сторона функциональных языков к которым Java конечно же не относится.</p>

<!-- excerpt -->

<h2 id="section">Императивный подход</h2>

<p>Классический императивный подход к оперированию коллекциями заключается в написании кода выполняющего обход и обработку каждого элемента коллекции. Типичный map в императивном стиле выглядит следующим образом:</p>

<pre class="code java"><code>List&lt;String&gt; result = new ArrayList&lt;String&gt;();
for (Position p : autocomplete.suggest(q)) {
	result.add(p.getTitle());
}
</code></pre>

<p>Не так уж и плохо. Но когда подобную операцию надо выполнять несколько раз в пределах одного метода, <code>for</code>‘ы начинают мозолить глаз.</p>

<h2 id="guava---">Guava спешит на помощь</h2>

<p>Мы используем <a href="http://code.google.com/p/guava-libraries/">guava</a> (бывшая google collections) для упрощения оперирования коллекциями. Guava предоставляет массу функциональных примитивов для работы с коллекциями. Несмотря на излишний синтаксический шум, в Java можно применять элементы функционального программирования. Правда не без ограничений. Давайте посмотрим на вышеприведенный пример переписанный с использованием guava.</p>

<pre class="code java"><code>List&lt;String&gt; result = transform(autocomplete.suggest(q), new Function&lt;Position, String&gt;() {
  @Override
  public String apply(final Position input) {
    return input.getTitle();
  }
});
</code></pre>

<p>Если честно, то стало еще хуже. Если раньше у нас был простой и понятный <code>for</code>-цикл, то сейчас мешанина из ключевых слов и названий типов. На сегодняшний день это пожалуй самое сильное ограничение Java — <em>объявлять предикаты по месту проблематично из-за синтаксиса анонимных классов</em>. Поэтому мы пошли на следующее ухищрение.</p>

<h2 id="map-">Вынос предикатов и map-функций</h2>

<p>Если вы писали в функциональном стиле, то может замечали что существенный процент всех функций передаваемых в <code>filter</code>/<code>map</code> являются чистыми функциями (без состояния) и не используют замыкание. Поэтому мы решили вынести их в виде статических членов класса к которым они относятся. Это позволяет определить их один раз в рамках класса к которому они привязаны и использовать в любом месте кодовой базы.</p>

<p>Например, вышеприведенный пример мы переписываем следующим образом:</p>

<pre class="code"><code>class Position {

	public static final Function&lt;Position, String&gt; retrieveName = new Function&lt;Position, String&gt;() {
		@Override
		public String apply(final Position input) {
			return input.getTitle();
		}
	};
}
</code></pre>

<p>Тогда клиент сводится к следующему коду:</p>

<pre class="code java"><code>List&lt;String&gt; result = transform(autocomplete.suggest(q), retrieveName);
</code></pre>

<p>что уже довольно вменяемо. В случае если функция обладает состоянием мы делаем для нее статическую фабрику в классе к которому она относится.</p>

<pre class="code"><code>class Span {
	
	public static Function&lt;Span, String&gt; chopFromText(final String text) {
		checkNotNull(text);
		return new Function&lt;Span, String&gt;() {
			@Override
			public String apply(Span input) {
				return input.cutFrom(text);
			}
		};
	}
	
	public String cutFrom(String string) {
		return string.substring(start, end);
	}
}
</code></pre>

<p>при этом клиент выглядит похожим образом:</p>

<pre class="code java"><code>List&lt;Span&gt; spans = asList(new Span(0, 5), new Span(6, 2), new Span(9, 3));
List&lt;String&gt; words = transform(spans, chopFromText("Hello to you!"));
// words -&gt; ["Hello", "to", "you"]
</code></pre>

<p>Этот подход работает благодаря тому что предикаты и map-функции принимают ровно один аргумент по типу которого можно определить к какому классу относить эту функцию. Таким образом, всякий раз когда вам нужен предикат на тип <code>Position</code> вы знаете что его надо искать именно в классе <code>Position</code>.</p>

<h2 id="section-1">Постскриптум</h2>

<p>Вы никогда не получите от Java экспрессивности присущей функциональным и тем более динамическим языкам. Поэтому в некотором отношении это конечно полумера. Но сделать свою жизнь немного проще используя элементы функционального программирования все же можно. И я считаю нужно.</p>

<p>Ну а Java программистам которые незнакомы с guava, я настоятельно советую обратить внимание на эту библиотеку. Она содержит массу вспомогательных классов и статических методов для решения типовых задач возникающий в ежедневной практике. Ее описание с легкостью может занять целый пост, настолько обширен ее функционал.</p>



	<div class="bar">
		<div class="g-plusone" data-size="medium"></div>
		<a href="https://twitter.com/share" class="twitter-share-button"
			data-url="http://bazhenov.me/blog/2012/05/12/functional-java.html"
			data-via="denis_bazhenov" data-lang="en">Tweet</a>

		<a href="https://twitter.com/denis_bazhenov" class="twitter-follow-button"
			data-show-count="false">Follow</a>
	</div>

	<div id="disqus_thread"></div>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

<!-- Google +1 button -->
<script type="text/javascript">
	(function() {
		var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
		po.src = 'https://apis.google.com/js/plusone.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
	})();
</script>

<!-- Twitter buttons -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

<!-- Disqus -->
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	var disqus_shortname='severe-reality';
	var disqus_developer=false;

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/javascript">
	MathJax.Hub.Config({
		tex2jax: {
			inlineMath: [['$','$'], ['\\(','\\)']],
			processEscapes: true
		}
	});
</script>

		<footer>
			<div class="content">
				<a href="http://feeds.feedburner.com/severe-reality">RSS Subscribe</a>
					|
				<a href="mailto:dotsid@gmail.com">Email</a>
			</div>
		</footer>
					
	</div>
	
	<script src="http://yandex.st/highlightjs/6.1/highlight.min.js"></script>
	<script>
	$(document).ready(function() {
		$('pre.code code').each(function(i, e) {hljs.highlightBlock(e, '  ')});
	});
	</script>
	
	
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-31484732-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

</body>
</html>