<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru-ru">
<head>
	 <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	 <meta http-equiv="content-type" content="text/html; charset=utf-8" />
	 <title>Один на миллион</title>
	 <meta name="author" content="Denis Bazhenov" />
	 <link href="http://feeds.feedburner.com/severe-reality" rel="alternate" title="Severe Reality" type="application/atom+xml" />

	 <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,600&subset=latin,cyrillic-ext,cyrillic' rel='stylesheet' type='text/css'>
	 <!-- syntax highlighting CSS -->
	 <link rel="stylesheet" href="/css/syntax.css" type="text/css" />

	 <!-- Homepage CSS -->
	 <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
	 <link rel="stylesheet" href="http://yandex.st/highlightjs/6.1/styles/idea.min.css">

	<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
</head>
<body>

	<div class="site">

		<header>
			<div class="content">
				<a href="/">Суровая реальность</a>
			</div>
		</header>

		<div class="post content">
	<h1>Один на миллион</h1>
	<div class="meta">
		<span class="date">16 April 2012</span>
		<span class="tags">
			
				<a href="/tags.html#theory">theory</a>
			
				<a href="/tags.html#math">math</a>
			
		</span>
		
	</div>
	
	
	<p>Вам наверное приходилось слышать что-то вроде: &ldquo;Этого не может быть. Вероятность этого менее одной миллионной&rdquo;. В бытовом понимании одна миллионная это некая несвершимая вероятность. Другими словами, этого просто не может произойти. Но насколько это вeрятное событие, если вы повторите эксперимент миллион раз? Конечно, вероятность наблюдать событие растет если вы повторяете эксперимент много раз подряд. Но все равно мы зачастую подсознательно пытаемся игнорировать такие события считая их невероятными.</p>

<!-- excerpt -->

<p>Тем не менее, в современных Интернет-системах которые обрабатывают миллионы запросов в сутки <em>не заметить</em> в течение дня событие с вероятностью в одну миллионную довольно сложно. И вот почему. Вероятность что интересующее нас событие (с исходной вероятностью <code>1/n</code>) не проявит себя ни в одном из <code>n</code> независимых экспериментов равно:</p>

<script type="math/tex; mode=display">(1-\frac{1}{n})^n</script>

<p>В этой формуле $\frac{1}{n}$ — вероятность события которое реализуется в одном эксперименте из <script type="math/tex">n</script>. <script type="math/tex">1-\frac{1}{n}</script> соответственно вероятность что это событие <em>не реализуется</em> в ходе эксперимента. Ну и не тяжело догодаться что $(1-\frac{1}{n})^n$ это вероятность с которой это событие <em>не реализуется в ходе <script type="math/tex">n</script> независимых экспериментов</em>. Для n = 1 000, если вы его подставите в формулу, итоговое значение вероятности составит 0.368 или 36.8%. Для n = 1 000 000, значение вероятности составит&hellip; те же самые 36.8%! <em>Редкость события всегда уравновешивается частотой повторения испытаний.</em></p>

<p>Обоснование этого возможно контринтуитивного результата кроется во <a href="http://ru.wikipedia.org/wiki/Замечательные_пределы#.D0.92.D1.82.D0.BE.D1.80.D0.BE.D0.B9_.D0.B7.D0.B0.D0.BC.D0.B5.D1.87.D0.B0.D1.82.D0.B5.D0.BB.D1.8C.D0.BD.D1.8B.D0.B9_.D0.BF.D1.80.D0.B5.D0.B4.D0.B5.D0.BB">втором замечательном пределе</a>, который большинству из нас преподавали в ходе курса высшей математики.</p>

<script type="math/tex; mode=display">\lim_{n \to +\infty}(1+\frac{1}{n})^n = e</script>

<p>Второй замечательный предел интенсивно используется при решении дифференциальных уравнений, но нас интересует одно из следствий этого предела.</p>

<p>Этот предел говорит нам о том что при растущем <code>n</code>, значение выражения <script type="math/tex">(1-\frac{1}{n})^n</script> стремится к значению <script type="math/tex">\frac{1}{e}</script>, которое является той самой константой приблизительно равной 0.368.</p>

<blockquote>
  <p>Я не буду здесь приводить доказательство этого следствия второго замечательного предела. Предел разумного количества формул на один пост достигнут :).</p>
</blockquote>

<p>Теперь давайте соберем все это вместе. Предположим что у вас есть некий баг (скажем, race condition в многопоточном приложении), который воспроизводится с вероятностью один на миллион. Фактически что говорит этот предел – если вы обслужите за день миллион запросов то вероятность того что этот баг не порявит себя ни в одном из запросов ~37%. То есть с вероятностью ~63% этот баг даст о себе знать <em>хотя бы один раз</em> за сутки.</p>

<p>Из этого можно сделать еще один вывод. Чем больше запросов вы обрабатываете за сутки, тем более редкие явления вы будете наблюдать в течение суток. 100 000 запросов в сутки? Тогда вероятность <script type="math/tex">\frac{1}{1 000 00}</script> для вас не редкость. 10 000 000? Тогда и одной десятимиллионной вас не удивишь.</p>

<p>Да пребудет с вами нормальное распределение!</p>



	<div class="bar">
		<div class="g-plusone" data-size="medium"></div>
		<a href="https://twitter.com/share" class="twitter-share-button"
			data-url="http://bazhenov.me/blog/2012/04/16/one-in-a-million.html"
			data-via="denis_bazhenov" data-lang="en">Tweet</a>

		<a href="https://twitter.com/denis_bazhenov" class="twitter-follow-button"
			data-show-count="false">Follow</a>
	</div>

	<div class="related">
		<h2>Related Posts</h2>
		<ul class="posts">
			
				<li>
					<span>26 Feb 2012</span> &raquo;
					<a href="/blog/2012/02/26/highload.html">О высокой нагрузке</a>
				</li>
			
				<li>
					<span>10 Jun 2011</span> &raquo;
					<a href="/blog/2011/06/10/deploy.html">Deploy и прочие неприятности</a>
				</li>
			
				<li>
					<span>17 Apr 2011</span> &raquo;
					<a href="/blog/2011/04/17/fair-lock.html">Fair lock</a>
				</li>
			
		</ul>
	</div>

	<div id="disqus_thread"></div>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

<!-- Google +1 button -->
<script type="text/javascript">
	(function() {
		var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
		po.src = 'https://apis.google.com/js/plusone.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
	})();
</script>

<!-- Twitter buttons -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

<!-- Disqus -->
<script type="text/javascript">
	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	var disqus_shortname='severe-reality';
	var disqus_developer=true;

	/* * * DON'T EDIT BELOW THIS LINE * * */
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>

		<footer>
			<div class="content">
				<a href="http://feeds.feedburner.com/severe-reality">RSS Subscribe</a>
					|
				<a href="mailto:dotsid@gmail.com">Email</a>
			</div>
		</footer>
					
	</div>

	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
	
	<script src="http://yandex.st/highlightjs/6.1/highlight.min.js"></script>
	<script>
	$(document).ready(function() {
		$('pre.code code').each(function(i, e) {hljs.highlightBlock(e, '  ')});
	});
	</script>
	<script type="text/javascript">
		MathJax.Hub.Config({
			tex2jax: {
				inlineMath: [['$','$'], ['\\(','\\)']],
				processEscapes: true
			}
		});
	</script>

</body>
</html>